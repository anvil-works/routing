<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Route Class - Routing Docs</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Route Class";
        var mkdocs_page_input_path = "routes/index.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Routing Docs
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Overview</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../installation/">Installation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../quick-start/">Quick Start</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../api-reference/">API Reference</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Navigating</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../navigating/">Navigation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../navigating/navigation-components/">Navigation Components</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../navigating/blocking-navigation/">Blocking Navigation</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Routes</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Route Class</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#route-attributes">Route Attributes</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#route-methods">Route Methods</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#excluding-routes-from-the-sitemap">Excluding Routes from the Sitemap</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#setting-meta-tags-per-route">Setting Meta Tags Per Route</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#not-found-form">Not Found Form</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#not-found-route">Not Found Route</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#raising-a-notfound-exception">Raising a NotFound Exception</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#error-form">Error Form</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#ordering-routes">Ordering Routes</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#server-routes">Server Routes</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="forms/">Forms</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="meta/">Route Meta Method</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="params/">Params</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="query/">Query</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="redirecting/">Redirecting</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Routing context</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../routing-context/">Routing Context</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Caching</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../caching/">Caching</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Data loading</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../data-loading/">Data Loading</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Theme</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../theme/">Theme</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Migrating</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../migrating/">Migrating</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Contributing</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../contributing/">Contributing</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Routing Docs</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Routes</li>
      <li class="breadcrumb-item active">Route Class</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="route-class">Route Class<a class="headerlink" href="#route-class" title="Permanent link">&para;</a></h1>
<p>The <code>Route</code> class is used to define routes for your app. When a user navigates to a path, the router will look for a matching route. The router will call <code>anvil.open_form</code> on the matching route's form.</p>
<pre><code class="language-python"># routes.py
from routing.router import Route

class IndexRoute(Route):
    path = &quot;/&quot;
    form = &quot;Pages.Index&quot;

class AboutRoute(Route):
    path = &quot;/about&quot;
    form = &quot;Pages.About&quot;

class ContactRoute(Route):
    path = &quot;/contact&quot;
    form = &quot;Pages.Contact&quot;
</code></pre>
<p>The above code can use the <code>Route.create()</code> method for convenience:</p>
<pre><code class="language-python"># routes.py
from routing.router import Route

IndexRoute = Route.create(path=&quot;/&quot;, form=&quot;Pages.Index&quot;)
AboutRoute = Route.create(path=&quot;/about&quot;, form=&quot;Pages.About&quot;)
ContactRoute = Route.create(path=&quot;/contact&quot;, form=&quot;Pages.Contact&quot;)
</code></pre>
<h2 id="route-attributes">Route Attributes<a class="headerlink" href="#route-attributes" title="Permanent link">&para;</a></h2>
<dl>
<dt><code>path</code></dt>
<dd>The path to navigate to. e.g. <code>/</code>, <code>/articles</code> or <code>/articles/:id</code>.</dd>
<dt><code>form</code></dt>
<dd>The form to open when the route is matched. e.g. <code>Pages.Index</code>.</dd>
<dt><code>error_form (optional)</code></dt>
<dd>The form to open when an error occurs. e.g. <code>Pages.Error</code>.</dd>
<dt><code>not_found_form (optional)</code></dt>
<dd>The form to open when the route is not found. e.g. <code>Pages.NotFound</code>.</dd>
<dt><code>pending_form (optional)</code></dt>
<dd>The form to open when the data is loading. e.g. <code>Pages.Loading</code>.</dd>
<dt><code>pending_delay=1</code></dt>
<dd>The delay before showing the pending form when the data is loading.</dd>
<dt><code>pending_min=0.5</code></dt>
<dd>The minimum time to show the pending form when the data is loading.</dd>
<dt><code>cache_form=False</code></dt>
<dd>Whether to cache the route's form. By default this is <code>False</code>.</dd>
<dt><code>cache_data=False</code></dt>
<dd>Whether to cache data. By default this is <code>False</code>.</dd>
<dt><code>gc_time=30*60</code></dt>
<dd>The time in seconds that determines when data is released from the cache for garbage collection. By default this is 30 minutes. When data is released from the cache, any cached forms with the same <code>path</code> and <code>cache_deps</code> will also be released.</dd>
<dt><code>server_fn (optional str)</code></dt>
<dd>The server function to call when the route is matched. e.g. <code>"get_article"</code>. This server function will be called with the same keyword arguments as the route's <code>load_data</code> method. Note this is optional and equivalent to defining a <code>load_data</code> method that calls the same server function.</dd>
<dt><code>server_silent=False</code></dt>
<dd>If <code>True</code> then the server function will be called using <code>anvil.server.call_s</code>. By default this is <code>False</code>.</dd>
<dt><code>sitemap=True</code></dt>
<dd>Whether to include this route in the sitemap. By default this is <code>True</code>.</dd>
</dl>
<h2 id="route-methods">Route Methods<a class="headerlink" href="#route-methods" title="Permanent link">&para;</a></h2>
<dl>
<dt><code>before_load</code></dt>
<dd>Called before the route is matched. If it raises a <code>Redirect</code>, navigation is redirected. If it returns a dictionary, its contents are merged into the navigation context (<code>nav_context</code>).</dd>
</dl>
<p>Note - you may prefer not to override this method, and instead use the <code>@hooks.before_load</code> decorator.</p>
<p>See the navigation documentation for practical usage examples.</p>
<dl>
<dt><code>parse_query</code></dt>
<dd>Should return a dictionary of query parameters. By default this returns the original query parameters.</dd>
<dt><code>parse_params</code></dt>
<dd>Should return a dictionary of path parameters. By default this returns the original path parameters.</dd>
<dt><code>meta</code></dt>
<dd>Should return a dictionary with the <code>title</code> and <code>description</code> of the page. This will be used to update the meta tags and the title of the page. By default this returns the original title and description.</dd>
<dt><code>load_data</code></dt>
<dd>Called when the route is matched. The return value will be available in the <code>data</code> property of the <code>RoutingContext</code> instance. By default this returns <code>None</code>.</dd>
<dt><code>load_form</code></dt>
<dd>This method is called with two arguments. The first argument is a form name (e.g. <code>"Pages.Index"</code>) or, if you are using cached forms, the cached form instance. The second argument is the <code>RoutingContext</code> instance. By default this calls <code>anvil.open_form</code> on the form.</dd>
<dt><code>cache_deps</code></dt>
<dd>Returns an object, by default the <code>query</code> dictionary (more information in the <a href="/routes/query/">query section</a> and the <a href="/routing-context/">RoutingContext section</a>). This method is part of the process of creating caching keys.</dd>
<dd>When a route needs to cache a form or data (more information in the <a href="/caching/">caching section</a>), it does so by storing it in a global dictionary under a caching key. This key is composed of the route's path and the return of its <code>cache_deps</code> method at the moment of caching.</dd>
<dd>If, when accessing the same route, its <code>cache_deps</code> method returns something different than when caching first occured, the caching key points to a different place within the cache, usually empty. The router thus understands this as a new route and navigates to it again.</dd>
</dl>
<h2 id="excluding-routes-from-the-sitemap">Excluding Routes from the Sitemap<a class="headerlink" href="#excluding-routes-from-the-sitemap" title="Permanent link">&para;</a></h2>
<p>By default, all routes are included in the sitemap. To exclude a route from the sitemap, set <code>sitemap = False</code> on your <code>Route</code> class:</p>
<pre><code class="language-python">from routing.router import Route

class PrivateRoute(Route):
    path = &quot;/admin&quot;
    form = &quot;Pages.Admin&quot;
    sitemap = False  # This route will NOT appear in the sitemap
</code></pre>
<p>Only routes with <code>sitemap = True</code> (the default) will be included in the sitemap.</p>
<h2 id="setting-meta-tags-per-route">Setting Meta Tags Per Route<a class="headerlink" href="#setting-meta-tags-per-route" title="Permanent link">&para;</a></h2>
<p>To control meta tags for SEO and social sharing, override the <code>meta</code> method on your <code>Route</code> class. Return a dictionary of tags you want to set for that route. You can set any meta tag, including Open Graph and custom tags.</p>
<p><strong>Example:</strong></p>
<pre><code class="language-python">from routing.router import Route

class ArticleRoute(Route):
    path = &quot;/articles/:id&quot;
    form = &quot;Pages.Article&quot;

    def meta(self, **loader_args):
        query = loader_args[&quot;query&quot;]  # Use query params for dynamic meta
        title = f&quot;Article: {query.get('title', 'Untitled')}&quot;
        return {
            &quot;title&quot;: title,
            &quot;description&quot;: f&quot;Viewing article: {title}&quot;,

            &quot;og:image&quot;: &quot;asset:article_cover.png&quot;,  # use asset: prefix or a full URL
            &quot;twitter:card&quot;: &quot;summary_large_image&quot;,  # arbitrary tags supported
        }
</code></pre>
<p><strong>Fallbacks:</strong></p>
<ul>
<li><code>og:title</code> and <code>og:description</code> will automatically use <code>title</code> and <code>description</code> if not set.</li>
<li>If a meta tag is not set for a route, it falls back to the value present at app load.</li>
</ul>
<p><strong>Server vs Client Meta Tags:</strong></p>
<ul>
<li><code>title</code>, <code>description</code>, <code>og:title</code> and <code>og:description</code> are set on the server.</li>
<li>All other tags are set after page load on the client.</li>
</ul>
<p><strong>og:image and other assets:</strong></p>
<ul>
<li>Use a full URL (e.g., <code>"https://my-app.anvil.app/_/theme/image.png"</code>)</li>
<li>Or use an asset from your app: <code>"asset:image.png"</code> and it will be resolved to the full URL</li>
</ul>
<h2 id="not-found-form">Not Found Form<a class="headerlink" href="#not-found-form" title="Permanent link">&para;</a></h2>
<p>There are two ways a route can be not found. The first is when the user navigates to a path that does not match any routes. The second is when a user raises a <code>NotFound</code> exception in a route's <code>before_load</code> or <code>load_data</code> method.</p>
<h3 id="not-found-route">Not Found Route<a class="headerlink" href="#not-found-route" title="Permanent link">&para;</a></h3>
<p>By definition, if there is no matching route, the router has no route to navigate to. If you want to handle this case, you can define a not found route.</p>
<pre><code class="language-python">from routing.router import Route

class NotFoundRoute(Route):
    form = &quot;Pages.NotFound&quot;
    default_not_found = True
</code></pre>
<p>The <code>NotFoundRoute</code> will be used when the user navigates to a path that does not match any routes. The <code>path</code> attribute should not be set, since this will be determined based on the path the user navigates to.</p>
<p>If no <code>default_not_found</code> attribute is set, then the router will raise a <code>NotFound</code> exception, which will be caught by Anvil's exception handler.</p>
<h3 id="raising-a-notfound-exception">Raising a NotFound Exception<a class="headerlink" href="#raising-a-notfound-exception" title="Permanent link">&para;</a></h3>
<p>If you raise a <code>NotFound</code> exception in a route's <code>before_load</code> or <code>load_data</code> method, the router will call the route's <code>load_form</code> method with the route's not found form.</p>
<pre><code class="language-python">from routing.router import Route

class ArticleRoute(Route):
    path = &quot;/articles/:id&quot;
    form = &quot;Pages.Article&quot;
    not_found_form = &quot;Pages.ArticleNotFound&quot;

    def load_data(self, **loader_args):
        id = loader_args[&quot;params&quot;][&quot;id&quot;]
        article = app_tables.articles.get(id=id)
        if article is None:
            raise NotFound(f&quot;No article with id {id}&quot;)
        return article
</code></pre>
<p>If a route raises a <code>NotFound</code> exception and there is no <code>not_found_form</code> attribute, the router will raise the exception, which will be caught by Anvil's exception handler.</p>
<h2 id="error-form">Error Form<a class="headerlink" href="#error-form" title="Permanent link">&para;</a></h2>
<p>When a route throws an exception, the router will call <code>anvil.open_form</code> on the matching route's error form.</p>
<p>If no error form is defined, the error will be caught by Anvil's exception handler.</p>
<pre><code class="language-python">from routing.router import Route

# Either define the error form globally
Route.error_form = &quot;Pages.Error&quot;

# or define the error form per route
class IndexRoute(Route):
    path = &quot;/&quot;
    form = &quot;Pages.Index&quot;
    error_form = &quot;Pages.Error&quot;
</code></pre>
<pre><code class="language-python"># Pages.Error
import anvil

class Error(ErrorTemplate):
    def __init__(self, routing_context: RoutingContext, **properties):
        self.init_components(**properties)
        self.routing_context = routing_context
        self.label.text = (
            f&quot;Error when navigating to {routing_context.path!r}, got {routing_context.error!r}&quot;
        )

    def form_show(self, **event_args):
        if anvil.app.environment.name.startswith(&quot;Debug&quot;):
            raise self.routing_context.error
</code></pre>
<h2 id="ordering-routes">Ordering Routes<a class="headerlink" href="#ordering-routes" title="Permanent link">&para;</a></h2>
<p>The router will try to match routes in the order they are defined.</p>
<pre><code class="language-python">from routing.router import Route

class AuthorsRoute(Route):
    path = &quot;/authors&quot;
    form = &quot;Pages.Authors&quot;

class NewAuthorRoute(Route):
    path = &quot;/authors/new&quot;
    form = &quot;Pages.NewAuthor&quot;

class AuthorRoute(Route):
    path = &quot;/authors/:id&quot;
    form = &quot;Pages.Author&quot;
</code></pre>
<p>In the above example, it's important that the <code>NewAuthorRoute</code> comes before the <code>AuthorRoute</code> in the list of routes. This is because <code>/authors/new</code> is a valid path for the <code>AuthorRoute</code>, so the router would successfully match the route and open the form.</p>
<h2 id="server-routes">Server Routes<a class="headerlink" href="#server-routes" title="Permanent link">&para;</a></h2>
<p>When a user navigates to a URL directly, the router will match routes on the server.</p>
<p>When you import your routes in server code, the router will automatically create a server route for each route.</p>
<pre><code class="language-python"># ServerRoutes.py
from . import routes
</code></pre>
<p>Under the hood this will look something like:</p>
<pre><code class="language-python"># ServerRoutes.py
from . import routes

# pseudo code - for illustration only
for route in Routes.__subclasses__():
    if route.path is None:
        continue

    @anvil.server.route(route.path)
    def server_route(**params):
        ...
        # return a response object that will open the form on the client
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../navigating/blocking-navigation/" class="btn btn-neutral float-left" title="Blocking Navigation"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="forms/" class="btn btn-neutral float-right" title="Forms">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../navigating/blocking-navigation/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="forms/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
