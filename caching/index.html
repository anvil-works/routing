<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Caching - Routing Docs</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Caching";
        var mkdocs_page_input_path = "caching/index.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Routing Docs
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Overview</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../quick-start/">Quick Start</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../how-it-works/">How It Works</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../api-reference/">Api Reference</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Navigating</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../navigating/">Navigation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../navigating/navigation-components/">Navigation Components</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../navigating/blocking-navigation/">Blocking Navigation</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Routes</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../routes/">Route Class</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../routes/forms/">Forms</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../routes/params/">Params</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../routes/query/">Query</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../routes/redirecting/">Redirecting</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Routing context</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../routing-context/">Routing Context</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Caching</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Caching</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#clearing-cache">Clearing Cache</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#form-caching">Form Caching</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#data-caching">Data Caching</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#stale-while-revalidate">Stale While Revalidate</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#partial-invalidation">Partial Invalidation</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#invalidating-contexts">Invalidating Contexts</a>
    </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Data loading</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../data-loading/">Data Loading</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Migrating</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../migrating/">Migrating</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Theme</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../theme/">Theme</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Routing Docs</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Caching</li>
      <li class="breadcrumb-item active">Caching</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="caching">Caching<a class="headerlink" href="#caching" title="Permanent link">&para;</a></h1>
<p>The routing library provides simple caching mechanisms for forms and data.
By default, the routing library will <strong>NOT</strong> cache any forms or data.</p>
<h2 id="clearing-cache">Clearing Cache<a class="headerlink" href="#clearing-cache" title="Permanent link">&para;</a></h2>
<p>To clear the cache, you can call the <code>clear_cache</code> function.</p>
<pre><code class="language-python">from routing import router
router.clear_cache()
</code></pre>
<h2 id="form-caching">Form Caching<a class="headerlink" href="#form-caching" title="Permanent link">&para;</a></h2>
<p>To override the default behavior, you can set the <code>Route.cache_form</code> attribute to <code>True</code>. This will cause the routing library to cache all forms.</p>
<pre><code class="language-python">from routing.router import Route
Route.cache_form = True
</code></pre>
<p>You can also set this attribute on specific routes.</p>
<pre><code class="language-python">class IndexRoute(Route):
    path = &quot;/&quot;
    form = &quot;Pages.Index&quot;
    cache_form = True
</code></pre>
<h2 id="data-caching">Data Caching<a class="headerlink" href="#data-caching" title="Permanent link">&para;</a></h2>
<p>The routing library can cache data that was loaded by the <code>load_data</code> method. If you are not using the <code>load_data</code> method, then you can skip this section. For more details see the <a href="/data-loading">Data Loading</a> section.</p>
<p>You can turn on data caching by setting the <code>cache_data</code> attribute on the route to <code>True</code>.</p>
<div class="admonition caching forms with data loaders">
<p class="admonition-title">Caching</p>
<p>If you are using <code>load_data</code> method and <code>cache_form</code> is set to <code>True</code>, then load_data method will not be called if there is an existing cached form.</p>
</div>
<!-- If you are using `STALE_WHILE_REVALIDATE` mode, we would recommend setting `cache_form` to `False` so that the `load_data` method is called with the data is stale. -->

<!-- ### No Cache

By default, the routes use the `NO_CACHE` mode, i.e. data will not be cached.

### Cache First

In `CACHE_FIRST` mode, the data will always be loaded from the cache if it is available.

### Network First

In `NETWORK_FIRST` mode, the data will always be loaded from the `load_data` when the user navigates to a route. However, if the `load_data` method raises an `AppOfflineError`, the data will be loaded from the cache. -->
<p>&lt;!--</p>
<h3 id="stale-while-revalidate">Stale While Revalidate<a class="headerlink" href="#stale-while-revalidate" title="Permanent link">&para;</a></h3>
<p>A more advanced mode is <code>STALE_WHILE_REVALIDATE</code>. In this mode, the data will be loaded from the cache, and then loaded in the background from the server, if the data is stale. If there is no data in the cache, then the form will not be instantiated until the <code>load_data</code> method returns a value.</p>
<pre><code class="language-python">from routing.router import Route, STALE_WHILE_REVALIDATE

Route.cache_data = STALE_WHILE_REVALIDATE

</code></pre>
<p>Or you can set this attribute on specific routes.</p>
<pre><code class="language-python">class IndexRoute(Route):
    path = &quot;/&quot;
    form = &quot;Pages.Index&quot;
    cache_data = STALE_WHILE_REVALIDATE
</code></pre>
<p>If you are using the <code>STALE_WHILE_REVALIDATE</code> mode, then you can customize the caching behavior by setting the <code>Route.stale_time</code> attribute. By default this is <code>0</code> seconds. i.e. the data is always considered stale when navigating to the route.</p>
<p>When the data is stale, the form will be instantiated with the stale data. The route's <code>load_data</code> method will be called in the background, and when the <code>load_data</code> method returns a value, the <code>routing_context</code> will be updated with the new data and raise the <code>"data_loaded"</code> event.</p>
<pre><code class="language-python">from routing import router

class ArticlesForm(ArticlesFormTemplate):
    def __init__(self, routing_context: router.RoutingContext, **properties):
        self.init_components(**properties)
        self.routing_context = routing_context
        self.routing_context.add_event_handler(&quot;data_loaded&quot;, self.on_data_loaded)
        self.routing_context.raise_init_events()

    def on_data_loaded(self, **event_args):
        self.repeating_panel.items = self.routing_context.data

``` --&gt;

## Caching keys

The routing library will cache forms and data by a cache key. The key is a combination of the path, and the dictionary returned by the `cache_deps` method. By default the `cache_deps` method returns the `query` dictionary.

## Invalidating Cache

If you want to invalidate the cache, you can call the `invalidate` function. Invalidating the cache will remove data and forms from the cache.

```python
from routing import router
router.invalidate(path=&quot;/articles&quot;)
</code></pre>
<p>The call signature for <code>invalidate</code> is:</p>
<pre><code class="language-python">
invalidate(*, path=None, deps=None, exact=False)
invalidate(path, **kws)
invalidate(routing_context, **kws)

</code></pre>
<dl>
<dt><code>path</code></dt>
<dd>
<p>The path to invalidate.</p>
</dd>
<dt><code>deps</code></dt>
<dd>
<p>The dependencies to invalidate. These are the same dependencies that are returned by the <code>cache_deps</code> method.</p>
</dd>
<dt><code>exact</code></dt>
<dd>
<p>If <code>True</code> then the path and deps must match exactly. If <code>False</code> (the default) then any path or deps that are a subset of path and deps arguments will be invalidated.</p>
</dd>
</dl>
<h2 id="partial-invalidation">Partial Invalidation<a class="headerlink" href="#partial-invalidation" title="Permanent link">&para;</a></h2>
<pre><code class="language-python">
from routing.router import Route

class ArticlesRoute(Route):
    path = &quot;/articles&quot;
    form = &quot;Pages.Articles&quot;

class ArticleRoute(Route):
    path = &quot;/articles/:id&quot;
    form = &quot;Pages.Article&quot;

</code></pre>
<p>In the above example if you call <code>invalidate("/articles", exact=True)</code> then data and forms associated with the <code>ArticlesRoute</code> will be invalidated. If you call <code>invalidate("/articles", exact=False)</code> then data and forms associated with the <code>ArticlesRoute</code> and all cached <code>ArticleRoute</code> will be invalidated since the <code>ArticleRoute</code> path is a subset of the <code>ArticlesRoute</code> path.</p>
<pre><code class="language-python">
from routing.router import Route

class ArticlesRoute(Route):
    path = &quot;/articles&quot;
    form = &quot;Pages.Articles&quot;

    def cache_deps(self, **loader_args):
        return {&quot;page&quot;: loader_args[&quot;query&quot;][&quot;page&quot;]}

    def parse_query(self, query):
        return {**query, &quot;page&quot;: int(query.get(&quot;page&quot;, 1))}

</code></pre>
<p>In the above example the data is cached depending on the <code>page</code> query parameter. If you call <code>invalidate("/articles")</code> then all data associated with all pages will be invalidated. A deps value of <code>{"page": 1}</code> is considered a subset of an empty deps argument. If you call <code>invalidate("/articles", exact=True)</code> then no data will be invalidated, since there is no match. Calling <code>invalidate("/articles", deps={"page": 1})</code> will invalidate only the data for the first page.</p>
<h2 id="invalidating-contexts">Invalidating Contexts<a class="headerlink" href="#invalidating-contexts" title="Permanent link">&para;</a></h2>
<p>A routing context also has an <code>invalidate</code> method for convenience.</p>
<pre><code class="language-python">
from routing import router

class ArticleForm(ArticleFormTemplate):
    def __init__(self, routing_context: router.RoutingContext, **properties):
        self.routing_context = routing_context
        self.init_components(**properties)

    def delete_button_click(self, **event_args):
        self.remove_from_parent()
        self.routing_context.invalidate(exact=True)

</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../routing-context/" class="btn btn-neutral float-left" title="Routing Context"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../data-loading/" class="btn btn-neutral float-right" title="Data Loading">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../routing-context/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../data-loading/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
